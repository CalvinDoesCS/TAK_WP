<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Headless WordPress - Test Page</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family:
          -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu,
          Cantarell, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        padding: 2rem;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
      }

      .header {
        background: white;
        padding: 2rem;
        border-radius: 10px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        margin-bottom: 2rem;
      }

      h1 {
        color: #667eea;
        margin-bottom: 0.5rem;
      }

      .subtitle {
        color: #666;
        font-size: 1.1rem;
      }

      .posts-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
        gap: 2rem;
        margin-top: 2rem;
      }

      .post-card {
        background: white;
        padding: 2rem;
        border-radius: 10px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        transition:
          transform 0.3s ease,
          box-shadow 0.3s ease;
      }

      .post-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
      }

      .post-title {
        color: #333;
        font-size: 1.5rem;
        margin-bottom: 1rem;
      }

      .post-date {
        color: #999;
        font-size: 0.9rem;
        margin-bottom: 1rem;
      }

      .post-content {
        color: #666;
        line-height: 1.6;
      }

      .loading {
        text-align: center;
        padding: 3rem;
        color: white;
        font-size: 1.2rem;
      }

      .error {
        background: #ff4444;
        color: white;
        padding: 1rem;
        border-radius: 5px;
        margin: 1rem 0;
      }

      .api-selector {
        display: flex;
        gap: 1rem;
        margin-top: 1rem;
      }

      button {
        background: #667eea;
        color: white;
        border: none;
        padding: 0.75rem 1.5rem;
        border-radius: 5px;
        cursor: pointer;
        font-size: 1rem;
        transition: background 0.3s ease;
      }

      button:hover {
        background: #5568d3;
      }

      button.active {
        background: #764ba2;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1>üöÄ Headless WordPress Demo</h1>
        <p class="subtitle">Testing GraphQL & REST API Integration</p>

        <div class="api-selector">
          <button id="graphql-btn" class="active" onclick="loadPosts('graphql')">
            Load via GraphQL
          </button>
          <button id="rest-btn" onclick="loadPosts('rest')">Load via REST API</button>
        </div>
      </div>

      <div id="posts-container" class="loading">Loading posts...</div>
    </div>

    <script>
      let currentAPI = "graphql";

      // Load posts on page load
      window.addEventListener("DOMContentLoaded", () => {
        loadPosts("graphql");
      });

      async function loadPosts(apiType) {
        currentAPI = apiType;

        // Update button states
        document
          .getElementById("graphql-btn")
          .classList.toggle("active", apiType === "graphql");
        document
          .getElementById("rest-btn")
          .classList.toggle("active", apiType === "rest");

        const container = document.getElementById("posts-container");
        container.innerHTML = '<div class="loading">Loading posts...</div>';

        try {
          let posts;

          if (apiType === "graphql") {
            posts = await fetchPostsGraphQL();
          } else {
            posts = await fetchPostsREST();
          }

          displayPosts(posts);
        } catch (error) {
          container.innerHTML = `
                    <div class="error">
                        <strong>Error loading posts:</strong> ${error.message}
                    </div>
                `;
        }
      }

      async function fetchPostsGraphQL() {
        const query = `
                query GetPosts {
                    posts(first: 10) {
                        nodes {
                            id
                            title
                            content
                            date
                            author {
                                node {
                                    name
                                }
                            }
                        }
                    }
                }
            `;

        const response = await fetch("http://localhost:8080/graphql", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({ query }),
        });

        const { data } = await response.json();

        return data.posts.nodes.map((post) => ({
          id: post.id,
          title: post.title,
          content: post.content,
          date: new Date(post.date).toLocaleDateString(),
          author: post.author.node.name,
        }));
      }

      async function fetchPostsREST() {
        const response = await fetch(
          "http://localhost:8080/wp-json/wp/v2/posts?per_page=10&_embed",
        );
        const posts = await response.json();

        return posts.map((post) => ({
          id: post.id,
          title: post.title.rendered,
          content: post.excerpt.rendered,
          date: new Date(post.date).toLocaleDateString(),
          author: post._embedded?.author?.[0]?.name || "Unknown",
        }));
      }

      function displayPosts(posts) {
        const container = document.getElementById("posts-container");

        if (posts.length === 0) {
          container.innerHTML =
            '<div class="loading">No posts found. Create some posts in WordPress!</div>';
          return;
        }

        container.innerHTML = `
                <div class="posts-grid">
                    ${posts
                      .map(
                        (post) => `
                        <article class="post-card">
                            <h2 class="post-title">${post.title}</h2>
                            <div class="post-date">
                                üìÖ ${post.date} | ‚úçÔ∏è ${post.author}
                            </div>
                            <div class="post-content">
                                ${post.content}
                            </div>
                        </article>
                    `,
                      )
                      .join("")}
                </div>
            `;
      }
    </script>
  </body>
</html>
